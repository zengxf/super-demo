## Ref
- 数据结构 https://www.jianshu.com/p/35588ecf33c1
- 数据结构 https://mp.weixin.qq.com/s?__biz=MzUxNTQyOTIxNA==&mid=2247484041&idx=1&sn=76d3bf1772f9e3c796ad3d8a089220fa

## 环境
- Win11，MySQL 8.0.29

## 准备 SQL
```sql
CREATE TABLE `testi` (
  `id` int NOT NULL AUTO_INCREMENT,
  `a` int DEFAULT NULL,
  `b` int DEFAULT NULL,
  `c` int DEFAULT NULL,
  `d` varchar(50) COLLATE utf8mb4_bin DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `k_abc` (`a`,`b`,`c`),
  KEY `k_bac` (`b`,`a`,`c`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='测试索引';

INSERT INTO testi(a, b, c, d) VALUES 
(1, 1, 1, 'a'),
(1, 2, 2, 'a'),
(1, 2, 3, 'a'),
(1, 3, 1, 'a'),
(1, 3, 2, 'a'),
(1, 3, 3, 'a'),
(2, 1, 1, 'b'),
(2, 2, 2, 'b'),
(2, 2, 3, 'b'),
(2, 3, 1, 'b'),
(2, 3, 2, 'b'),
(2, 3, 3, 'b'),
(3, 1, 1, 'c'),
(3, 2, 2, 'c'),
(3, 2, 3, 'c'),
(3, 3, 1, 'c'),
(3, 3, 2, 'c'),
(3, 3, 3, 'c');
```

## 测试 SQL
```sql
SELECT @@optimizer_switch;
SET optimizer_switch = 'index_condition_pushdown=on'; -- 默认是开启的

-- k_abc 索引搞定 
mysql> EXPLAIN
    -> SELECT a, b, c FROM testi WHERE a = 1 AND b = 1;
+----+-------------+-------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref         | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | testi | NULL       | ref  | k_abc,k_bac   | k_abc | 10      | const,const |    1 |   100.00 | Using index |
+----+-------------+-------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

-- k_abc 索引搞不定 
mysql> EXPLAIN
    -> SELECT a, b, c FROM testi WHERE a = 1 AND b > 1;
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | testi | NULL       | range | k_abc,k_bac   | k_abc | 10      | NULL |    5 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

-- k_abc 索引搞不定
mysql> EXPLAIN
    -> SELECT a, b, c FROM testi WHERE a = 1 AND b > 1 AND c = 2;
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | testi | NULL       | range | k_abc,k_bac   | k_abc | 10      | NULL |    5 |    10.00 | Using where; Using index |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)


-- k_bac 索引搞不定
mysql> EXPLAIN
    -> SELECT a, b, c FROM testi WHERE b = 1 AND a > 1;
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | testi | NULL       | range | k_abc,k_bac   | k_bac | 10      | NULL |    2 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

-- k_bac 索引搞不定
mysql> EXPLAIN
    -> SELECT a, b, c FROM testi WHERE b = 1 AND a > 1 AND c = 2;
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | testi | NULL       | range | k_abc,k_bac   | k_bac | 10      | NULL |    2 |    10.00 | Using where; Using index |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)




-- 分析：树状输出
mysql> EXPLAIN FORMAT = tree
    -> SELECT a, b, c FROM testi WHERE a = 1 AND b > 1 AND c = 2;
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN
    |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Filter: ((testi.c = 2) and (testi.a = 1) and (testi.b > 1))  (cost=1.26 rows=1)
    -> Covering index range scan on testi using k_abc over (a = 1 AND 1 < b)  (cost=1.26 rows=5)
 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

-- 在 FORMAT = tree 基础上，真实执行 SQL 并分析用时
mysql> EXPLAIN ANALYZE
    -> SELECT a, b, c FROM testi WHERE a = 1 AND b > 1 AND c = 2;
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN
                                                                                        |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Filter: ((testi.c = 2) and (testi.a = 1) and (testi.b > 1))  (cost=1.26 rows=1) (actual time=0.016..0.026 rows=2 loops=1)
    -> Covering index range scan on testi using k_abc over (a = 1 AND 1 < b)  (cost=1.26 rows=5) (actual time=0.014..0.023 rows=5 loops=1)
 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```