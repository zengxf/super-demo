# MySql 并发控制 - 锁和 MVCC

标签（空格分隔）： DB

---

**[原文参考](https://draveness.me/tag/mysql/)**

## 两阶段锁协议（2PL）
- 将事务的获取锁和释放锁划分成了增长（Growing）和缩减（Shrinking）两个不同的阶段
- - 增长阶段，一个事务可以获得锁但是不能释放锁；
- - 缩减阶段，事务只可以释放锁，不能获得新的锁
- 产生问题：死锁
- 两个变种：
- - Strict 2PL：事务持有的互斥锁必须在提交后再释放；
- - Rigorous 2PL：事务持有的所有锁必须在提交后释放；

## MySQL 与 MVCC（多版本并发控制）
- 读事务请求时，数据库程序会直接从多个版本的数据项中具有最大时间戳的返回。
- 更新操作，事务会先读取最新版本的数据计算出数据更新后的结果，然后创建一个新版本的数据，新数据的时间戳是目前数据行的最大版本 `+1`
- MySQL 会将版本最低的数据定时从数据库中清除